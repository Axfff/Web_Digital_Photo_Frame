<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>送给敦老师！</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='leaflet.css') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .photo-gallery {
            position: relative;
        }

        #photo {
            max-width: 100%;
        }

        #play-button {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        #map {
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
    <button onclick="startButton()" id="startButton">打开</button>
    <div style="display:none" class="photo-gallery" id="afterOpen">
        <img id="photo" src="" alt="Travel Photo">
        <button id="play-button">Play</button>
        <div id="map" style="width: 100%; height: 200px;"></div>
    </div>
    <audio id="audio">
        <source src="/archive/JGA2023/files/music" type="audio/wav">
    </audio>

    <script src="https://webapi.amap.com/loader.js"></script>
    <script>
        window._AMapSecurityConfig = {
        securityJsCode:'4f02a3141390f294788b7f75432eec59',
        }
        AMapLoader.load({
          "key": "0b2672541f2ed600930ea227abea90fc",              // 申请好的Web端开发者Key，首次调用 load 时必填
          "version": "2.0",   // 指定要加载的 JS API 的版本，缺省时默认为 1.4.15
          "plugins": ['AMap.Scale','AMap.ToolBar'],           // 需要使用的的插件列表，如比例尺'AMap.Scale'等
        }).then((AMap)=>{
          var map = new AMap.Map('map', {
            zoom: 13
          });
          map.addControl(new AMap.Scale())
          map.addControl(new AMap.ToolBar())
        }).catch((e)=>{
          console.error(e);  //加载错误提示
        });

        const photos =
        [
            { src: '/archive/JGA2023/files/6438751f55be951399218733e689deb.jpg', lat: 40, lon: 116.5 },
            { src: '/archive/JGA2023/files/8b8e9bb32694e8c06b4e49ed3f6f1e2.jpg', lat: 22.3, lon: 114.16 },
            { src: '/archive/JGA2023/files/c4c26009bba1e67c7437c2ad1046109.jpg', lat: 22.3, lon: 114.166 },
            { src: '/archive/JGA2023/files/0e77d11203b6c4f7007be74c51c377b.jpg', lat: 22.3, lon: 114.166 },
            { src: '/archive/JGA2023/files/8b3dc31e4836be81f9a0d148ce153f0.jpg', lat: 22.3, lon: 114.166 },
            { src: '/archive/JGA2023/files/40ff9a37c11a00b44d08d6a89e2b9d2.jpg', lat: 22.3, lon: 114.166 },
            { src: '/archive/JGA2023/files/W020230728588450364825.jpg', lat: 22.166, lon: 113.5 },
            // Add more photos here
        ]; // Add your photo URLs here


        // Add a marker function
        function addMarker(lat, lon) {
            marker = new AMap.Marker({
            icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",
            position: [lat, lon],
            offset: new AMap.Pixel(-13, -30)
            });
            marker.setMap(map);
        }

        let currentIndex = 0;
        const photoElement = document.getElementById("photo");
        const playButton = document.getElementById("play-button");
        const audio = document.getElementById("audio");
        const mapElement = document.getElementById("map");

        function startButton(){
            document.getElementById("startButton").style.display="none";
            playOrPause();
            document.getElementById("afterOpen").style.display="contents";
        }

        function displayPhoto(index) {
            var photo = photos[index];
            photoElement.src = photo.src;
            map.panTo([photo.lat, photo.lon]); // Center map at the photo's location
            addMarker(photo.lat, photo.lon);
        }

        function playOrPause() {
            if (audio.paused) {
                audio.play();
                playButton.innerText = "Pause";
            } else {
                audio.pause();
                playButton.innerText = "Play";
            }
        }

        playButton.addEventListener("click", playOrPause);

        function nextPhoto() {
            currentIndex = (currentIndex + 1) % photos.length;
            displayPhoto(currentIndex);
        }

        function prevPhoto() {
            currentIndex = (currentIndex - 1 + photos.length) % photos.length;
            displayPhoto(currentIndex);
        }

        setInterval(nextPhoto, 5000); // Change photo every 5 seconds
        displayPhoto(currentIndex); // Initial display

        // Add Baidu Maps integration here
    </script>
</body>
</html>
